{% extends 'navbar.html' %}

{% block title %}Crawls{% endblock %}

{% block script %}
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{google_key}}&libraries=marker&callback=initMap" type="text/javascript"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/show_map.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/latlng_avg.js') }}"></script>
<script>
function onLoad(){
    console.log("onLoad in pub_crawl")
}

function initMap() {
    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = new google.maps.DirectionsRenderer();

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom:7,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    directionsRenderer.setMap(map);
<!--    directionsRenderer.setPanel(document.getElementById('panel'));-->

    var request = {
        origin: {placeId: "ChIJy2QpfVUDdkgR_ZjHMTwf28A"},
        destination: {placeId: "ChIJYdET4FQDdkgRbjvXg_CcAm0"},
        waypoints: [{stopover: true, location: { placeId: "ChIJNQsDclUDdkgRvZqcNZvdRgM" }}],
        optimizeWaypoints: false,
        travelMode: google.maps.DirectionsTravelMode.WALKING
    };

    directionsService.route(request, function(response, status) {
        var no_of_legs = response.routes[0].legs.length
        for (let i = 0; i < response.routes[0].legs.length; i++) {
            duration = response.routes[0].legs[i].duration.value/60
        }
        if (status == google.maps.DirectionsStatus.OK) {
            directionsRenderer.setDirections(response);
        }
    });

};
function removeOptions(selectElement) {
   var i, L = selectElement.options.length - 1;
   for(i = L; i >= 0; i--) {
      selectElement.remove(i);
   }
}
function area_changed(dropdown_pick) {
    pub_area = {{ pub_area | tojson }}
    var select = document.getElementById("start");
    removeOptions(document.getElementById('start'));
    var option = document.createElement("option");
    option.text = "select from " + dropdown_pick + " pubs";
    select.add(option);
    if (dropdown_pick == 'all') {
        for(var i = 0; i < pub_area.length; i++) {
            var opt = pub_area[i][1];
            var el = document.createElement("option");
            el.textContent = pub_area[i][1];
            el.value = pub_area[i][0];
            select.appendChild(el);
        }
    } else {
        filteredArray = pub_area.filter(item => item[2] == dropdown_pick);
        for(var i = 0; i < filteredArray.length; i++) {
            var opt = filteredArray[i][1];
            var el = document.createElement("option");
            el.textContent = filteredArray[i][1];
            el.value = filteredArray[i][0];
            select.appendChild(el);
        }
    }
}
</script>

{% endblock %}

{% block full_screen %}

<div id="the_crawl"></div>
{% endblock %}

{% block map %}
<div id="map" style="width:100%; height:450px;"></div>
<div id="panel" style="width: 300px; float: right;"></div>
{% endblock %}

{% block photo %}
<form action="{{ url_for('pub_crawl_show') }}" method="post">
    <!--<div class="form-group row">
        <label class="control-label col-sm-2" for="station">Start area:</label>
        <div class="col-sm-10">
          <select class="form-control" id="station" name="station" disabled>
              <option value="">Select starting area ---</option>
                {% for station in station_list %}
                    <option value="{{station}}">{{station}}</option>
                {% endfor %}
              <option selected="selected">ANY</option>
          </select>
        </div>
    </div>-->
    <div class="form-group row">
        <label class="control-label col-sm-2" for="start">Area:</label>
        <div class="col-sm-10">
          <select class="form-control" id="area" name="area" onchange="area_changed(this.value);">
              <option value="all"></option>
                {% for area in area_list %}
                    <option value="{{area}}">{{area}}</option>
                {% endfor %}
          </select>
        </div>
    </div>
    <div class="form-group row">
        <label class="control-label col-sm-2" for="start">Start pub:</label>
        <div class="col-sm-10">
          <select class="form-control" id="start" name="start" required>
              <option value=""></option>
                {% for pa in pub_area %}
                    <option value="{{pa[0]}}">{{pa[1]}}</option>
                {% endfor %}
          </select>
        </div>
    </div>
    <div class="form-group row">
        <label class="control-label col-sm-2" for="walk">Max walk:</label>
        <div class="col-sm-10">
            <select class="form-control" id="walk" name="walk">
                <option value="0">Select maximum walk between venues ---</option>
                <option value="1">1 min</option>
                <option value="3">3 min</option>
                <option value="5">5 min</option>
                <option value="10">10 min</option>
                <option value="15">15 min</option>
                <option value="0">15+ min</option>
            </select>
        </div>
    </div>
    <div class="form-group row">
        <label class="control-label col-sm-2" for="favourite">Favourite:</label>
        <div class="col-sm-10">
            <select class="form-control" id="favourite" name="favourite">
                <option value="all">Optional: pub feature ---</option>
                <option value="tv">Live sport on tv</option>
                <option value="garden">Outdoor space</option>
                <option value="music">Live entertainment</option>
                <option value="late">Past 11pm opening</option>
                <option value="food">Serves food</option>
                <option value="toilets">Super clean washrooms</option>
                <option value="cheap">Money saver</option>
                <option value="games">Board games and quiz nights</option>
            </select>
        </div>
    </div>
    <div class="form-group row">
        <label class="control-label col-sm-2" for="stops">No.of stops:</label>
        <div class="col-sm-10">
            <select class="form-control" id="stops" name="stops" required>
                <option style='color: #ffff00' value="">Required ...</option>
                {% for number in range_list %}
                    <option value="{{number}}">{{number}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="form-group row">
        <label class="control-label col-sm-2" for="criteria">Criteria:</label>
        <div class="col-sm-10">
            <select class="form-control" id="criteria" name="criteria">
                <option value="NEAREST">Nearest</option>
                <option value="SCORE">Highest rated</option>
            </select>
        </div>
    </div>
    <div class="form-group row">
        <button id="submit" type="submit" class="btn btn-primary btn-block" name="submit" value="submit">Submit</button>
    </div>
  </div>
</form>
{% endblock %}
{% block navbar_crawls %}<a class="nav-link active_custom" href="/pub/crawl">Pub Crawls</a>{% endblock %}
{% block pub_read_btn %}{% endblock %}
{% block pub_edit_btn %}{% endblock %}
{% block pub_del_btn %}{% endblock %}
{% block rev_read_btn %}{% endblock %}
{% block rev_add_btn %}{% endblock %}
{% block rev_edit_btn %}{% endblock %}
{% block rev_del_btn %}{% endblock %}
{% block search_btn %}{% endblock %}