{% extends 'base.html' %}

{% block title %}Pub Details{% endblock %}

{% block script %}
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/layout.css') }}">
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/show_map.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/add_markers.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/map_listen_click.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/map_listen_bounds.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/listen_events.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/listen_search.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/class_event_handler.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/mouse_down_click.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/html/insert_line.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/html/populate_form.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/sum_score.js') }}"></script>
<style>
.top-buffer {
    margin-top:20px;
}
.andy_width {
    width: 100%
}
.checked {
    color: yellow;
}
</style>
<script>
function onLoad(){
    console.log("onLoad in pub_read");
    pub_review = {{ pub_review | tojson }}
    config = {{ config | tojson }}
    pub_fields = config['pub']['column']
    review_fields = config['review']['column']
    pub_review_fields = config['pub']['column'].concat(config['review']['column'])
    input_controls = config['control']['input']
    dropdown_controls = config['control']['dropdown']
    slider_controls = config['control']['slider']
    check_controls = config['control']['check']
    star_controls = config['control']['star']
    score_list = config['review']['score']
    form = {{ form_type | tojson }}
    populate_form(form);

    var js = document.createElement("script");
    js.type = "text/javascript";
    if ( window.navigator.onLine == true) {
        js.src = 'https://maps.googleapis.com/maps/api/js?key={{google_key}}&libraries=places&callback=initMap'
        document.head.appendChild(js)
    } else {
        alert('You appear to offline so maps cannot be displayed')
    }
}

function initMap(){
    console.log("initMap in pub_read");
    pub_review = {{ pub_review | tojson }}
    zoom = 19
    map = show_map(pub_review[0]['latitude'], pub_review[0]['longitude'], zoom)
    add_markers(map, zoom, pub_review)
}
</script>
{% endblock %}

{% block main %}
<div class="col-md-12 center-block text-center">
    <strong>
        <a style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none; padding: 5px 0 0 0">{{pub_review[0]['name']}}</a>
    </strong>
</div>
{% endblock %}

{% block left %}
<div class="col">
    <div class="row">
        <div id="map" class="map_height"></div>
    </div>
</div>
{% endblock %}

{% block right %}
<a href="{{ url_for('photo_upload', pub_identity=pub_review[0]['pub_identity']) }}">
    <img class="map_height"
    src="{{ url_for('static', filename='images/venue/' + pub_review[0]['photo_identity'] + '.jpeg') }}"
    onerror="this.onerror=null; this.src='/static/icons/camera.png'"
    style="display: block; object-fit: cover;" alt="upload photo">
</a>
{% endblock %}

{% block centre %}
    <div class="col center-block">
        {% include "pub_form_refactored.html" %}
        {% include "review_form_refactored.html" %}
        <div class="row justify-content-center top-buffer">
            <a class="btn btn-primary" href="{{ url_for('pub_edit', pub_id=pub_review[0]['pub_identity']) }}" role="button">Edit Pub</a>
            <a class="btn btn-primary" href="{{ url_for('pub_list', list_type='area', id_type=pub_review[0]['area']) }}" role="button">Same area pubs</a>
            <a class="btn btn-primary" href="{{ url_for('home') }}" role="button">Back to Home</a>
        </div>
        {% include "footer.html" %}
    </div>
{% endblock %}
