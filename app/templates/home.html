{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block script %}
<!--<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>-->
<!--<script src="https://apis.google.com/js/api.js" type="text/javascript"></script>-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/layout.css') }}">
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/distancing.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/display.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/display_none.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/show_map_home.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/html/populate_table.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/add_map_click.js') }}"></script>

<script>
function myFunction(check_item) {
  var checkBox = document.getElementById(check_item);
  var text = document.getElementById("img_" + check_item);
  if (checkBox.checked == true){
    window.location.replace("/pub/list/" + check_item + "/True");
  } else {
     text.style.opacity = "0.25"
  }
}
function initMap() {
    key = {{ google_key | tojson }}
    pubs = {{ pubs | tojson }}
    pub = {{ pub | tojson }}
    crawl = {
        start: {{ start | tojson }},
        walk: {{ walk | tojson }},
        favourite: {{ favourite | tojson }},
        stops: {{ stops | tojson }},
        criteria: {{ criteria | tojson }}
    }
    var stop_offs = []
    if ( crawl.favourite = 'all' ) {
        crawl.score = pub[0]['score']
        crawl.score_name = 'Rating'
    } else {
        crawl.score = pub[0][favourite]
        crawl.score_name = favourite
    }
    pub_first_stop = {
        name: pub[0]['name'],
        distance_from_first: 0,
        distance_next: 0,
        score: pub[0]['score'],
        star: pub[0]['star'],
        star_score: pub[0][pub[0]['star']],
        lat: pub[0]['latitude'],
        lng: pub[0]['longitude'],
        place: pub[0]['place'],
        pub_identity: pubs[0]['pub_identity']
    }
    pubs = pubs.filter (obj => !(obj.place == pub_first_stop.place))
    if ( crawl.favourite != 'all' ) {
        pubs = pubs.filter (obj => (obj[crawl.favourite] === true))
    }
    if (pubs.length > 0 ) {
        stop_offs.push(pub_first_stop)
        for (let i=0; i<crawl.stops; i++) {
            list_got = distancing(pub_first_stop, stop_offs[i], pubs, crawl)
            if ( list_got === undefined ) {
                break;
            } else {
                stop_offs.push(list_got)
                pubs = pubs.filter (obj => !(obj.place == list_got.place))
            }
        }
        displayCrawl(stop_offs, 'map');
    } else {
        displayNone(pub_first_stop);
    }
    var myOptions = {
        zoom: 14,
        center: new google.maps.LatLng(52.0, -0.02),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoomControl: false,
        streetViewControl: false,
        disableDefaultUI: true
    }
    map2 = new google.maps.Map(document.getElementById("map2"), myOptions)
    map2.addListener("click", (event) => {
        console.log('you clicked on the map')
        event.stop();
        window.location.href = "/pub/map/all"
    });
}

</script>

<script>
function onLoad(){
    var photo_array = {{ photo_array | tojson }}
    var map_lat = {{ map_lat | tojson }}
    var map_lng = {{ map_lng | tojson }}
    var map_view = {{ map_view | tojson }}
    var config = {{ config | tojson }}
    var areas = {{ areas | tojson }}
    var pubs_reviews = {{ pubs_reviews | tojson }}
    var js = document.createElement("script");
    js.type = "text/javascript";
    if ( window.navigator.onLine == true) {
        js.src = 'https://maps.googleapis.com/maps/api/js?key={{google_key}}&libraries=places&callback=initMap'
        document.head.appendChild(js)
    } else {
        alert('You appear to offline so maps cannot be displayed')
    }
}
</script>
{% endblock %}

{% block slider %}
<div class="col-12 center-block text-center">
    <p style="padding: 5px 0 0 0">
    Welcome to the Pub Crawls.
    Create your own pub crawl or search for pubs by area, rating or favourite features.
    Please enjoy the site and remember to drink responsibly .......
    </p>
</div>
{% endblock %}

{% block full_screen %}
<div class="col" id="main">
    {% include "home_crawl.html" %}
    {% include "home_features.html" %}
    {% include "home_area.html" %}
    {% include "home_rating.html" %}
    {% include "home_location.html" %}
</div>

<script>
var form_node = document.createElement("div");
form_node.setAttribute("class", "form-group row");
id_row = "row_checks"
form_node.setAttribute("id", id_row);
document.getElementById('feature-list').appendChild(form_node);
</script>

{% for field in config['control']['check'] %}
    <script>

        var div_node = document.createElement("div");
        div_node.setAttribute("class", "col");
        id_div = "div_" + '{{field}}'
        div_node.setAttribute("id", id_div);
        document.getElementById(id_row).appendChild(div_node);

        var check_node = document.createElement("input");
        check_node.setAttribute("type", 'checkbox');
        check_node.setAttribute("id", '{{field}}');
        check_node.setAttribute("name", '{{field}}');
        check_node.setAttribute("style", "display: none;");
        check_node.setAttribute("onclick", "myFunction('{{field}}')")
        document.getElementById(id_div).appendChild(check_node);

        var img_label_node = document.createElement("label")
        img_label_node.setAttribute("for", '{{field}}');
        id_img_label = "id_img_" + '{{field}}'
        img_label_node.setAttribute("id", id_img_label);
        document.getElementById(id_div).appendChild(img_label_node);

        switch('{{field}}') {
            case 'tv':
                name_label = "live sports"
                break;
            case 'garden':
                name_label = "outside space"
                break;
            case 'music':
                name_label = "live music"
                break;
            case 'late':
                name_label = "past midnight"
                break;
            case 'meals':
                name_label = "serves food"
                break;
            case 'toilets':
                name_label = "clean toilets"
                break;
            case 'cheap':
                name_label = "cheap pint"
                break;
            case 'games':
                name_label = "pub games"
                break;
            default:
                name_label = "error"
        }
        var textnode = document.createTextNode(name_label);
        img_label_node.appendChild(textnode);

        var img_node = document.createElement("img");
        img_node.setAttribute("src", "{{ url_for('static', filename='icons/' + field + '.png') }}")
        img_node.setAttribute("width", "50")
        img_node.setAttribute("height", "50")
        id_img = "img_" + '{{field}}'
        img_node.setAttribute("id", id_img);
        img_node.setAttribute("name", id_img);
        img_node.style.opacity = "1"
        document.getElementById(id_img_label).appendChild(img_node);

    </script>
{% endfor %}
{% endblock %}

{% block footer %}
{% include "footer.html" %}
{% endblock %}


{% block navbar_login %}{% endblock %}
{% block navbar_admin %}{% endblock %}
{% block navbar_home %}<a class="nav-link active_custom" href="/index">Home</a>{% endblock %}</li>
{% block pub_read_btn %}{% endblock %}
{% block pub_edit_btn %}{% endblock %}
{% block pub_del_btn %}{% endblock %}
{% block rev_read_btn %}{% endblock %}
{% block rev_add_btn %}{% endblock %}
{% block rev_edit_btn %}{% endblock %}
{% block rev_del_btn %}{% endblock %}
{% block search_btn %}{% endblock %}
