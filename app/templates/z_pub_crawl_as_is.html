{% extends 'base.html' %}

{% block title %}Crawls{% endblock %}

{% block script %}
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{google_key}}&libraries=marker&callback=initMap" type="text/javascript"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/show_map.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/maps/latlng_avg.js') }}"></script>
<script>
function onLoad(){
    console.log("onLoad in pub_crawl")

}

function initMap() {
    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = new google.maps.DirectionsRenderer();

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom:7,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    });

    directionsRenderer.setMap(map);
<!--    directionsRenderer.setPanel(document.getElementById('panel'));-->

    var request = {
        origin: {placeId: "ChIJy2QpfVUDdkgR_ZjHMTwf28A"},
        destination: {placeId: "ChIJYdET4FQDdkgRbjvXg_CcAm0"},
        waypoints: [{stopover: true, location: { placeId: "ChIJNQsDclUDdkgRvZqcNZvdRgM" }}],
        optimizeWaypoints: false,
        travelMode: google.maps.DirectionsTravelMode.WALKING
    };

    directionsService.route(request, function(response, status) {
        var no_of_legs = response.routes[0].legs.length
        for (let i = 0; i < response.routes[0].legs.length; i++) {
            duration = response.routes[0].legs[i].duration.value/60
        }
        if (status == google.maps.DirectionsStatus.OK) {
            directionsRenderer.setDirections(response);
        }
    });

};
function removeOptions(selectElement) {
   var i, L = selectElement.options.length - 1;
   for(i = L; i >= 0; i--) {
      selectElement.remove(i);
   }
}
function area_changed(dropdown_pick) {
    pub_area = {{ pub_area | tojson }}
    var select = document.getElementById("start");
    removeOptions(document.getElementById('start'));
    var option = document.createElement("option");
    option.text = "select from " + dropdown_pick + " pubs";
    select.add(option);
    if (dropdown_pick == 'all') {
        for(var i = 0; i < pub_area.length; i++) {
            var opt = pub_area[i][1];
            var el = document.createElement("option");
            el.textContent = pub_area[i][1];
            el.value = pub_area[i][0];
            select.appendChild(el);
        }
    } else {
        filteredArray = pub_area.filter(item => item[2] == dropdown_pick);
        for(var i = 0; i < filteredArray.length; i++) {
            var opt = filteredArray[i][1];
            var el = document.createElement("option");
            el.textContent = filteredArray[i][1];
            el.value = filteredArray[i][0];
            select.appendChild(el);
        }
    }
}
</script>

{% endblock %}

{% block left %}
<div id="map" style="width:100%; height:200px;"></div>
<div id="panel" style="width: 300px; float: right;"></div>
{% endblock %}

{% block right %}
    {% include "crawl_selection.html" %}
{% endblock %}
