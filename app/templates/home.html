{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block script %}
<!--<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>-->
<!--<script src="https://apis.google.com/js/api.js" type="text/javascript"></script>-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/distancing.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/display.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/crawl/display_none.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='javascript/html/populate_table.js') }}"></script>
<style>
.top-buffer {
    margin-top:20px;
}
.andy_width {
    width: 100%
}
.checked {
    color: yellow;
}
</style>
<script>
function myFunction(check_item) {
  var checkBox = document.getElementById(check_item);
  var text = document.getElementById("img_" + check_item);
  if (checkBox.checked == true){
    window.location.replace("/pub/list/" + check_item + "/True");
  } else {
     text.style.opacity = "0.25"
  }
}
</script>
<script>
function onLoad(){
    var photo_array = {{ photo_array | tojson }}
    var map_lat = {{ map_lat | tojson }}
    var map_lng = {{ map_lng | tojson }}
    var map_view = {{ map_view | tojson }}
    var config = {{ config | tojson }}
    var areas = {{ areas | tojson }}
    var pubs_reviews = {{ pubs_reviews | tojson }}
    var js = document.createElement("script");
    js.type = "text/javascript";
    if ( window.navigator.onLine == true) {
        js.src = 'https://maps.googleapis.com/maps/api/js?key={{google_key}}&libraries=places&callback=initMap'
        document.head.appendChild(js)
    } else {
        alert('You appear to offline so maps cannot be displayed')
    }
}
function initMap(){

    key = {{ google_key | tojson }}
    pubs = {{ pubs | tojson }}
    pub = {{ pub | tojson }}
    crawl = {
        start: {{ start | tojson }},
        walk: {{ walk | tojson }},
        favourite: {{ favourite | tojson }},
        stops: {{ stops | tojson }},
        criteria: {{ criteria | tojson }}
    }
    var stop_offs = []
    if ( crawl.favourite = 'all' ) {
        crawl.score = pub[0]['score']
        crawl.score_name = 'Rating'
    } else {
        crawl.score = pub[0][favourite]
        crawl.score_name = favourite
    }
    pub_first_stop = {
        name: pub[0]['name'],
        distance_from_first: 0,
        distance_next: 0,
        score: pub[0]['score'],
        star: pub[0]['star'],
        star_score: pub[0][pub[0]['star']],
        lat: pub[0]['latitude'],
        lng: pub[0]['longitude'],
        place: pub[0]['place'],
        pub_identity: pubs[0]['pub_identity']
    }
    pubs = pubs.filter (obj => !(obj.place == pub_first_stop.place))
    if ( crawl.favourite != 'all' ) {
        pubs = pubs.filter (obj => (obj[crawl.favourite] === true))
    }
    if (pubs.length > 0 ) {
        stop_offs.push(pub_first_stop)
        for (let i=0; i<crawl.stops; i++) {
            list_got = distancing(pub_first_stop, stop_offs[i], pubs, crawl)
            if ( list_got === undefined ) {
                break;
            } else {
                stop_offs.push(list_got)
                pubs = pubs.filter (obj => !(obj.place == list_got.place))
            }
        }
        displayCrawl(stop_offs);
    } else {
        displayNone(pub_first_stop);
    }
}
</script>
{% endblock %}
<!--<strong>{{session.get('user_id')}}</strong>-->
{% block slider %}
<div class="col-12 center-block text-center">
    <p style="padding: 5px 0 0 0">
    Welcome to the Pub Crawls.
    Create your own pub crawl or search for pubs by location, rating or favourite features.
    Please enjoy the site and remember to drink responsibly .......
    </p>
</div>

{% endblock %}

{% block full_screen %}
<div class="col">
    <div class="row">
        <div class="col-12 center-block text-center">
            <strong>
            <a style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none; padding: 5px 0 0 0">Create your own pub crawl</a>
            </strong>
        </div>
    </div>
    <div class="row">
        <div class="col-12 center-block text-center">
            <div id="map" style="width:100%; height:200px;"></div>
        </div>
    </div>
    <div class="row" id="route" hidden></div>
    <div class="row top-buffer">
        <div class="col-12 center-block text-center">
            <strong>
            <a style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none; padding: 5px 0 0 0">Search for pubs by feature</a>
            </strong>
        </div>
    </div>
    <div class="row justify-content-center align-items-center" id="feature-list"></div>

    <div class="row">
        <div class="col-12 center-block text-center">
            <strong>
            <a href="/pub/crawl" style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none;">Search pubs by location</a>
            </strong>
        </div>
    </div>
    <div class="row">
        <div id="carouselExampleIndicators" class="carousel slide andy_width" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                {% for x in areas.length %}
                    <li data-target="#carouselExampleIndicators" data-slide-to="{{x}}"></li>
                {% endfor %}
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="{{ url_for('static', filename='images/location/' + areas[0]['area'].lower() + '.jpg') }}" style="height: 175px; width: 300px" alt="">
                    <div class="carousel-caption">
                        <a href="/pub/list/area/{{areas[0]['area']}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{areas[0]['area']}}</a>
                    </div>
                </div>
                {% for area in areas[1:] %}
                    <div class="carousel-item">
                        <img class="d-block w-100" src="{{ url_for('static', filename='images/location/' + area['area'].lower() + '.jpg') }}" style="height: 175px; width: 300px" alt="">
                        <div class="carousel-caption">
                            <a href="/pub/list/area/{{area['area']}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{area['area']}}</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    <div class="row top-buffer">
        <div class="col-12 center-block text-center">
            <strong>
            <a href="/pub/list/all/all" style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none; padding: 5px 0 0 0">Pubs ordered by rating</a>
            </strong>
        </div>
    </div>
    <div class="row">
        <div id="carouselExampleIndicators2" class="carousel slide andy_width" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                {% for x in pubs_reviews.length %}
                    <li data-target="#carouselExampleIndicators" data-slide-to="{{x}}"></li>
                {% endfor %}
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="d-block w-100" src="{{ url_for('static', filename='images/venue/' + pubs_reviews[0]['name'].lower() + '.jpeg') }}" style="height: 175px; width: 300px" alt="">
                    <div class="carousel-caption">
                        <a href="/pub/{{pubs_reviews[0]['pub_identity']}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{pubs_reviews[0]['name']}}</a>
                        <p>
                            {% if (pubs_reviews[0]['score'] > 80) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                            {% elif (pubs_reviews[0]['score'] > 60) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pubs_reviews[0]['score'] > 40) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pubs_reviews[0]['score'] > 20) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pubs_reviews[0]['score'] > 0) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% else %}
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% endif %}
                            </p>
                    </div>
                </div>
                {% for pub in pubs_reviews[1:] %}
                    <div class="carousel-item">
                        <img class="d-block w-100" src="{{ url_for('static', filename='images/venue/' + pub['name'].lower() + '.jpeg') }}" style="height: 175px; width: 300px" alt="">
                        <div class="carousel-caption">
                            <a href="/pub/{{pub['pub_identity']}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{pub['name']}}</a>
                            <p>
                            {% if (pub['score'] > 80) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                            {% elif (pub['score'] > 60) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pub['score'] > 40) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pub['score'] > 20) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% elif (pub['score'] > 0) %}
                                <span class="fa fa-star checked"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% else %}
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                                <span class="fa fa-star"></span>
                            {% endif %}
                            </p>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators2" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators2" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    <div class="row justify-content-center top-buffer">
        <a class="btn btn-primary" href="{{ url_for('pub_add') }}" role="button">Add New</a>
    </div>
<!--    <div class="row">-->
<!--        <div class="col-12 center-block text-center">-->
<!--            <strong>-->
<!--            <a href="/pub/list/all/all" style="font-weight: bold; font-size: 16px; color: #000000; text-decoration: none; padding:5px 0 0 0">Pubs by quality</a>-->
<!--            </strong>-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="row">-->
<!--        <div id="carouselExampleIndicators3" class="carousel slide" data-ride="carousel">-->
<!--            <ol class="carousel-indicators">-->
<!--                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>-->
<!--                {% for x in config['review']['photo'].length %}-->
<!--                    <li data-target="#carouselExampleIndicators" data-slide-to="{{x}}"></li>-->
<!--                {% endfor %}-->
<!--            </ol>-->
<!--            <div class="carousel-inner">-->
<!--                <div class="carousel-item active">-->
<!--                    <img class="d-block w-100" src="{{ url_for('static', filename='images/category/' + config['review']['photo'][0] + '.jpg') }}" style="height: 175px; width: 300px" alt="">-->
<!--                    <div class="carousel-caption">-->
<!--                        <a href="/pub/list/star/{{config['review']['photo'][0]}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{config['review']['photo'][0]}}</a>-->
<!--                    </div>-->
<!--                </div>-->
<!--                {% for conf in config['review']['photo'][1:] %}-->
<!--                    <div class="carousel-item">-->
<!--                        <img class="d-block w-100" src="{{ url_for('static', filename='images/category/' + conf.lower() + '.jpg') }}" style="height: 175px; width: 300px" alt="">-->
<!--                        <div class="carousel-caption">-->
<!--                            <a href="/pub/list/star/{{conf}}" style="font-weight: bold; font-size: 24px; color: #FFFFFF; text-decoration: none;">{{conf}}</a>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                {% endfor %}-->
<!--            </div>-->
<!--            <a class="carousel-control-prev" href="#carouselExampleIndicators3" role="button" data-slide="prev">-->
<!--                <span class="carousel-control-prev-icon" aria-hidden="true"></span>-->
<!--                <span class="sr-only">Previous</span>-->
<!--            </a>-->
<!--            <a class="carousel-control-next" href="#carouselExampleIndicators3" role="button" data-slide="next">-->
<!--                <span class="carousel-control-next-icon" aria-hidden="true"></span>-->
<!--                <span class="sr-only">Next</span>-->
<!--            </a>-->
<!--        </div>-->
<!--    </div>-->
</div>
<script>
var form_node = document.createElement("div");
form_node.setAttribute("class", "form-group row");
id_row = "row_checks"
form_node.setAttribute("id", id_row);
document.getElementById('feature-list').appendChild(form_node);
</script>
{% for field in config['control']['check'] %}
    <script>

        var div_node = document.createElement("div");
        div_node.setAttribute("class", "col");
        id_div = "div_" + '{{field}}'
        div_node.setAttribute("id", id_div);
        document.getElementById(id_row).appendChild(div_node);

        var check_node = document.createElement("input");
        check_node.setAttribute("type", 'checkbox');
        check_node.setAttribute("id", '{{field}}');
        check_node.setAttribute("name", '{{field}}');
        check_node.setAttribute("style", "display: none;");
        check_node.setAttribute("onclick", "myFunction('{{field}}')")
        document.getElementById(id_div).appendChild(check_node);

        var img_label_node = document.createElement("label")
        img_label_node.setAttribute("for", '{{field}}');
        id_img_label = "id_img_" + '{{field}}'
        img_label_node.setAttribute("id", id_img_label);
        document.getElementById(id_div).appendChild(img_label_node);

        var img_node = document.createElement("img");
        img_node.setAttribute("src", "{{ url_for('static', filename='icons/' + field + '.png') }}")
        img_node.setAttribute("width", "50")
        img_node.setAttribute("height", "50")
        id_img = "img_" + '{{field}}'
        img_node.setAttribute("id", id_img);
        img_node.setAttribute("name", id_img);
        img_node.style.opacity = "1"
        document.getElementById(id_img_label).appendChild(img_node);

    </script>
{% endfor %}

{% endblock %}

{% block navbar_login %}{% endblock %}
{% block navbar_admin %}{% endblock %}
{% block navbar_home %}<a class="nav-link active_custom" href="/index">Home</a>{% endblock %}</li>
{% block pub_read_btn %}{% endblock %}
{% block pub_edit_btn %}{% endblock %}
{% block pub_del_btn %}{% endblock %}
{% block rev_read_btn %}{% endblock %}
{% block rev_add_btn %}{% endblock %}
{% block rev_edit_btn %}{% endblock %}
{% block rev_del_btn %}{% endblock %}
{% block search_btn %}{% endblock %}
